name: Update Raw VPN Configs

on:
  schedule:
    - cron: "*/10 * * * *"  # Каждые 10 минут
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.8"

      - name: Install dependencies
        run: pip install pybase64 requests pyyaml geoip2

      - name: Run config script from /website
        run: |
          cd website
          python update_raw_configs.py
          cd ..

      - name: Write README.md
        run: |
          cat > README.md << 'EOF'
# 🌐 ASTRACAT VPN (Free V2Ray/VLESS via GitHub)

Конфигурации обновляются **автоматически каждые 10 минут** и поддерживаются в формате **Clash / Karing VPN**.

📦 **Прямая ссылка на YAML-конфиг:**  
\`\`\`
https://raw.githubusercontent.com/ASTRACAT2022/VPN-FREE-astra.net-V1/refs/heads/main/website/configs/raw_configs.yaml
\`\`\`

---

## 📥 Как использовать конфиг

### 🪟 Для Clash (ПК: Windows/macOS/Linux)

1. Установите [Clash for Windows](https://github.com/Fndroid/clash_for_windows_pkg) или [Clash Verge](https://github.com/clash-verge-rev/clash-verge-rev).
2. Откройте приложение.
3. Перейдите в раздел **Profiles / Профили**.
4. Нажмите **“+”** или **“New Profile” / “Добавить”**.
5. Вставьте ссылку:
   \`\`\`
   https://raw.githubusercontent.com/ASTRACAT2022/VPN-FREE-astra.net-V1/refs/heads/main/website/configs/raw_configs.yaml
   \`\`\`
6. Нажмите **“Download” / “Загрузить”**, затем **“Set as Active” / “Активировать”**.

---

### 📱 Для Karing VPN (Android/iOS)

1. Установите **Karing VPN** из Google Play или App Store.
2. Перейдите в раздел **订阅 / Subscription**.
3. Нажмите **添加订阅 / Add Subscription**.
4. Вставьте ссылку:
   \`\`\`
   https://raw.githubusercontent.com/ASTRACAT2022/VPN-FREE-astra.net-V1/refs/heads/main/website/configs/raw_configs.yaml
   \`\`\`
5. Назовите, например: `ASTRACAT VPN`.
6. Нажмите **保存 / Save**, затем **更新 / Update**.

---

## ♻️ Обновление

Файл автоматически обновляется каждые 10 минут с помощью GitHub Actions.  
Вы всегда получаете самые актуальные сервера.

---

**Проект ASTRACAT от сообщества с открытым кодом. Не продаётся. Используйте свободно.**
EOF

      - name: Commit and push changes
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git pull --rebase
          git add website/configs/ README.md
          git commit -m "🚀 ASTRACAT — обновлено 10 минут назад" || echo "No changes to commit"
          git push
